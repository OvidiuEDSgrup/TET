SELECT (select MAX(VALUTA.DENUMIRE_VALUTA) from valuta,pozdoc where pozdoc.valuta=valuta.valuta) as C001, CASE max(doc.Gestiune_primitoare) WHEN '' THEN max(terti.denumire) ELSE ISNULL( NULLIF((select max( descriere) from infotert i where i.subunitate=max(terti.subunitate) and i.tert=max(terti.tert) and i.identificator= max(ltrim(doc.Gestiune_primitoare))),''), max(terti.denumire))  END as C002, max(terti.denumire) as C003, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='SEDIU') as C004, max(pozdoc.cota_tva) as C005, (Select max(gestiuni.denumire_gestiune) from gestiuni where gestiuni.cod_gestiune=max(pozdoc.gestiune)) as C006, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='ORDREG') as C007, isnull((select max(banca3) from infotert where subunitate=max(pozdoc.subunitate) and tert=max(pozdoc.tert) and identificator=''), '') as C008, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='NUME') as C009, (select max(judete.denumire) from judete where max(terti.judet) = judete.cod_judet) as C010, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='JUDET') as C011, isnull((select max(observatii) from infotert where subunitate=max(pozdoc.subunitate) and tert=max(pozdoc.tert) and identificator=''), '') as C012, max(doc.numar) as C013, max(convert(CHAR(10),pozdoc.data_facturii,103)) as C014, convert(char(16),convert(money,max(pozdoc.CURS),2),2) as C015, max(terti.cont_in_banca) as C016, MAX(POZDOC.CONTRACT) as C017, max(terti.cod_fiscal) as C018, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='CODFISC') as C019, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='CAPITALS') as C020, isnull((select top 1 b.denumire from bancibnr b where b.cod=max(terti.banca)),max(terti.banca)) as C021, MAX(pozDOC.factura) as C022, CASE max(doc.gestiune_primitoare) WHEN '' THEN rtrim(isnull((select max(localitati.oras) from localitati where max(terti.localitate) = localitati.cod_oras),max(terti.localitate)))+','+max((terti.adresa)) ELSE '' END as C023, CASE max(doc.gestiune_primitoare) when '' then '' ELSE isnull(rtrim(ISNULL((select max(oras) from localitati where cod_oras=max(infotert.pers_contact)),max(infotert.pers_contact)))+','+rtrim(ltrim(max(e_mail)))+', jud. '+ltrim(ISNULL((select max(denumire) from judete where cod_judet=max(infotert.telefon_fax2)),max(infotert.telefon_fax2))),rtrim(isnull((select max(l.oras) from localitati l where max(terti.localitate) = l.cod_oras),max(terti.localitate)))+','+max(terti.adresa)) END as C024, rtrim(isnull((select max(localitati.oras) from localitati where max(terti.localitate) = localitati.cod_oras),max(terti.localitate)))+','+max(terti.adresa) as C025, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='ADRESA') as C026, convert(char(20),convert(money,round(sum(pozdoc.cantitate*pozdoc.pret_vanzare),2)),1) as C027, max(nomencl.um) as C028, convert(char(19),convert(money,round(sum(pozdoc.cantitate*pozdoc.pret_vanzare*pozdoc.cota_tva/100),2)),1) as C029, convert(char(13),convert(money,round(max(pozdoc.pret_vanzare),2)),1) as C030, ROW_NUMBER() OVER(ORDER BY pozdoc.numar_pozitie) as C031, (select max(comanda) from stocuri s where s.subunitate=max(pozdoc.subunitate) and s.cod_gestiune=max(pozdoc.gestiune) and cod=max(pozdoc.cod) and cod_intrare=max(pozdoc.cod_intrare)) as C032, max(pozdoc.discount) as C033, rtrim(ltrim((case when max(nomencl.tip)='F' then (select max(denumire) from mfix where subunitate<>'DENS' and numar_de_inventar=max(pozdoc.cod_intrare)) when max(pozdoc.barcod)='' or 1=0 then max(RTRIM(nomencl.cod)+'-'+LTRIM(nomencl.denumire)) else (select max(RTRIM(ns.cod_special)+'-'+LTRIM(ns.denumire)) from nomspec ns where max(pozdoc.barcod)=ns.cod_special and pozdoc.cod=ns.cod and max(pozdoc.tert)=ns.tert) end))) as C034, ISNULL((select ltrim(rtrim(max(cod_de_bare))) from codbare c where c.cod_produs= pozdoc.cod),'') as C035, convert(char(10),convert(money,round(sum(pozdoc.cantitate),3)),1) as C036, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,round((select sum(p.cantitate*p.pret_valuta) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C037, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,-1*round((select sum(p.cantitate*(p.pret_valuta-p.pret_vanzare)) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C038, convert(char(15),convert(money,round((select sum(p.tva_deductibil) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)/*and av.cod_gestiune=p.gestiune*/),2)),1) as C039, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,round((select sum(p.cantitate*p.pret_valuta*p.cota_tva/100) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C040, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,-round((select sum(p.cantitate*p.pret_valuta*p.cota_tva/100-p.tva_deductibil) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C041, convert(char(15),convert(money,(select sum(round(convert(decimal(17,5),p.cantitate*p.pret_vanzare),2 )+p.tva_deductibil) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)/*and av.cod_gestiune=p.gestiune*/)),1) as C042, convert(char(15),convert(money,round((select sum(round(convert(decimal(17,5),p.cantitate*p.pret_vanzare),2 )) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data) /*and av.cod_gestiune=p.gestiune*/),2)),1) as C043, max(CONVERT(CHAR(10),pozdoc.data_scadentei,103)) as C044, max(anexafac.eliberat) as C045, left(max(anexafac.ora_expedierii),2)+':'+substring(max(anexafac.ora_expedierii),3,2) as C046, max(substring(ANEXAFAC.OBSERVATII,1,50)) as C047, max(anexafac.numarul_mijlocului) as C048, (select val_alfanumerica from par where tip_parametru='ID' and parametru=rtrim(host_id())+'N') as C049, LTRIM(convert(char(15),convert(money,round((select sum(CASE WHEN pd.cantitate<=0 THEN 0 ELSE pd.cantitate END* nc.greutate_specifica) from pozdoc pd join nomencl nc on pd.cod = nc.cod where pd.numar = max(pozdoc.numar) and pd.subunitate = max(pozdoc.subunitate) and pd.tip = max(pozdoc.tip)),2)),1)) as C050, (case when (select sum(p.discount) from pozdoc p, avnefac av where av.terminal=max(avnefac.terminal) and p.subunitate=av.subunitate and p.tip=av.tip and p.numar=av.numar and av.data=p.data)>0 then 'Total fara disc.' else '' end) as C051, max(anexafac.numele_delegatului) as C052, MAX(DOC.DATA_SCADENTEI) as C053, max(CONVERT(CHAR(10),anexafac.data_expedierii,103)) as C054, (select left(val_alfanumerica,13) from par where tip_parametru='ID' and parametru=rtrim(host_id())+'C') as C055, max(anexafac.seria_buletin) as C056, MAX(anexafac.numar_buletin) as C057, isnull(nullif((select max(mijloc_tp) from infotert where subunitate=max(pozdoc.subunitate) and tert=max(pozdoc.tert) and identificator=max(doc.gestiune_primitoare)),''),max(anexafac.mijloc_de_transport)) as C058, '('+rtrim(cast((select max(d.discount_p) from doc d where d.subunitate=max(pozdoc.subunitate) and d.numar=max(pozdoc.numar) and d.tip=max(pozdoc.tip) and d.data=max(pozdoc.data)) as char))+'%)' as C059,'' AS C060,'' AS C061,'' AS C062,'' AS C063,'' AS C064,'' AS C065,'' AS C066,'' AS C067,'' AS C068,'' AS C069,'' AS C070,'' AS C071,'' AS C072,'' AS C073,'' AS C074,'' AS C075,'' AS C076,'' AS C077,'' AS C078,'' AS C079,'' AS C080,'' AS C081,'' AS C082,'' AS C083,'' AS C084,'' AS C085,'' AS C086,'' AS C087,'' AS C088,'' AS C089,'' AS C090,'' AS C091,'' AS C092,'' AS C093,'' AS C094,'' AS C095,'' AS C096,'' AS C097,'' AS C098,'' AS C099,'' AS C100 FROM pozdoc left join avnefac on pozdoc.subunitate=avnefac.subunitate and pozdoc.tip=avnefac.tip and pozdoc.numar=avnefac.numar and avnefac.data=pozdoc.data left join doc on pozdoc.subunitate=doc.subunitate and pozdoc.tip=doc.tip and pozdoc.numar=doc.numar and pozdoc.data=doc.data left join terti on pozdoc.subunitate=terti.subunitate and pozdoc.tert=terti.tert left join infotert on pozdoc.subunitate=infotert.subunitate and pozdoc.tert=infotert.tert and doc.Gestiune_primitoare=infotert.identificator left join nomencl on pozdoc.cod=nomencl.cod left join anexafac on anexafac.subunitate=pozdoc.subunitate and anexafac.numar_factura=pozdoc.factura left join gestiuni on pozdoc.gestiune=gestiuni.cod_gestiune WHERE ''='' AND AVNEFAC.TERMINAL='4520' GROUP BY  pozdoc.cod, pozdoc.pret_vanzare, pozdoc.pret_valuta, avnefac.cod_gestiune, pozdoc.tert, pozdoc.numar, pozdoc.data, pozdoc.Numar_pozitie