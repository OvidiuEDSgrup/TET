SELECT *
-- (select VALUTA.DENUMIRE_VALUTA from valuta where pozdoc.valuta=valuta.valuta) as C001, max(doc.Gestiune_primitoare)+(select gestiuni.denumire_gestiune from gestiuni where pozdoc.gestiune=gestiuni.cod_gestiune) as C002, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='NUME') as C003, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='SEDIU') as C004, max(pozdoc.cota_tva) as C005, max(rtrim(gestiuni.cod_gestiune)+' '+rtrim(gestiuni.denumire_gestiune)) as C006, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='ORDREG') as C007, isnull((select max(banca3) from infotert where subunitate=max(pozdoc.subunitate) and tert=max(pozdoc.tert) and identificator=''), '') as C008, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='NUME') as C009, '' as C010, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='JUDET') as C011, max(doc.cod_Gestiune)+(select g.denumire_gestiune from gestiuni g where g.cod_gestiune= max(doc.cod_gestiune)) as C012, '' as C013, max(pozdoc.factura) as C014, max(convert(CHAR(10),pozdoc.data,103)) as C015, convert(money,round(max(pozdoc.CURS),2)) as C016, '' as C017, MAX(POZDOC.FACTURA) as C018, '' as C019, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='CODFISC') as C020, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='CAPITALS') as C021, '' as C022, MAX(DOC.NUMAR) as C023, '' as C024, (select rtrim(g.loc_de_munca)+' '+rtrim(l.denumire) from gestcor g join lm l on g.loc_de_munca=l.cod where g.gestiune=max(pozdoc.gestiune_primitoare)) as C025, (SELECT MAX(val_alfanumerica) from par where tip_parametru='GE' and parametru='ADRESA') as C026, convert(char(20),convert(money,round(sum(pozdoc.cantitate*pozdoc.pret_valuta),2)),1) as C027, max(nomencl.um) as C028, convert(char(19),convert(money,round(sum(pozdoc.cantitate*pozdoc.pret_valuta*pozdoc.cota_tva/100),2)),1) as C029, convert(char(13),convert(money,round(max(pozdoc.pret_vanzare),2)),1) as C030, 'INCREMENT' as C031, (select max(comanda) from stocuri s where s.subunitate=max(pozdoc.subunitate) and s.cod_gestiune=max(pozdoc.gestiune) and cod=max(pozdoc.cod) and cod_intrare=max(pozdoc.cod_intrare)) as C032, max(pozdoc.discount) as C033, rtrim(ltrim((case when max(nomencl.tip)='F' then (select max(denumire) from mfix where subunitate<>'DENS' and numar_de_inventar=max(pozdoc.cod_intrare)) when max(pozdoc.barcod)='' or 1=0 then max(RTRIM(nomencl.cod)+'-'+LTRIM(nomencl.denumire)) else (select max(RTRIM(ns.cod_special)+'-'+LTRIM(ns.denumire)) from nomspec ns where max(pozdoc.barcod)=ns.cod_special and pozdoc.cod=ns.cod and max(pozdoc.tert)=ns.tert) end))) as C034, ISNULL((select ltrim(rtrim(max(cod_de_bare))) from codbare c where c.cod_produs= pozdoc.cod),'') as C035, convert(char(10),convert(money,round(sum(pozdoc.cantitate),3)),1) as C036, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,round((select sum(p.cantitate*p.pret_valuta) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C037, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,-1*round((select sum(p.cantitate*(p.pret_valuta-p.pret_vanzare)) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C038, convert(char(15),convert(money,round((select sum(p.tva_deductibil) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)/*and av.cod_gestiune=p.gestiune*/),2)),1) as C039, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,round((select sum(p.cantitate*p.pret_valuta*p.cota_tva/100) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C040, (case when (select sum(p.discount) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data))>0 then convert(char(15),convert(money,-round((select sum(p.cantitate*p.pret_valuta*p.cota_tva/100-p.tva_deductibil) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)),2)),1) else '' end) as C041, convert(char(15),convert(money,(select sum(round(convert(decimal(17,5),p.cantitate*p.pret_vanzare),2 )+p.tva_deductibil) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data)/*and av.cod_gestiune=p.gestiune*/)),1) as C042, convert(char(15),convert(money,round((select sum(round(convert(decimal(17,5),p.cantitate*p.pret_vanzare),2 )) from pozdoc p where p.subunitate= max(pozdoc.subunitate) and p.tip= max(pozdoc.tip) and p.numar= max(pozdoc.numar) and p.data= max(pozdoc.data) /*and av.cod_gestiune=p.gestiune*/),2)),1) as C043, max(CONVERT(CHAR(10),pozdoc.data_scadentei,103)) as C044, max(anexadoc.eliberat) as C045, left(max(anexadoc.ora_expedierii),2)+':'+substring(max(anexadoc.ora_expedierii),3,2) as C046, max(substring(ANEXADOC.observatii,1,50)) as C047, max(anexadoc.numarul_mijlocului) as C048, (select val_alfanumerica from par where tip_parametru='ID' and parametru=rtrim(host_id())+'N') as C049, LTRIM(convert(char(15),convert(money,round((select sum(CASE WHEN pd.cantitate<=0 THEN 0 ELSE pd.cantitate END* nc.greutate_specifica) from pozdoc pd join nomencl nc on pd.cod = nc.cod where pd.numar = max(pozdoc.numar) and pd.subunitate = max(pozdoc.subunitate) and pd.tip = max(pozdoc.tip)),2)),1)) as C050, (case when (select sum(p.discount) from pozdoc p, avnefac av where av.terminal=max(avnefac.terminal) and p.subunitate=av.subunitate and p.tip=av.tip and p.numar=av.numar and av.data=p.data)>0 then 'Total fara disc.' else '' end) as C051, max(anexadoc.numele_delegatului) as C052, MAX(DOC.DATA_SCADENTEI) as C053, max(CONVERT(CHAR(10),anexadoc.data_expedierii,103)) as C054, (select left(val_alfanumerica,13) from par where tip_parametru='ID' and parametru=rtrim(host_id())+'C') as C055, max(anexadoc.seria_buletin) as C056, MAX(anexadoc.numar_buletin) as C057, isnull(nullif((select max(mijloc_tp) from infotert where subunitate=max(pozdoc.subunitate) and tert=max(pozdoc.tert) and identificator=max(doc.gestiune_primitoare)),''),max(anexadoc.mijloc_de_transport)) as C058, '('+rtrim(cast((select max(d.discount_p) from doc d where d.subunitate=max(pozdoc.subunitate) and d.numar=max(pozdoc.numar) and d.tip=max(pozdoc.tip) and d.data=max(pozdoc.data)) as char))+'%)' as C059,'' AS C060,'' AS C061,'' AS C062,'' AS C063,'' AS C064,'' AS C065,'' AS C066,'' AS C067,'' AS C068,'' AS C069,'' AS C070,'' AS C071,'' AS C072,'' AS C073,'' AS C074,'' AS C075,'' AS C076,'' AS C077,'' AS C078,'' AS C079,'' AS C080,'' AS C081,'' AS C082,'' AS C083,'' AS C084,'' AS C085,'' AS C086,'' AS C087,'' AS C088,'' AS C089,'' AS C090,'' AS C091,'' AS C092,'' AS C093,'' AS C094,'' AS C095,'' AS C096,'' AS C097,'' AS C098,'' AS C099,'' AS C100 
FROM avnefac
,pozdoc
,nomencl
,anexadoc
,doc
--,gestiuni 
WHERE avnefac.subunitate=pozdoc.subunitate and avnefac.tip=pozdoc.tip and avnefac.numar=pozdoc.numar and avnefac.data=pozdoc.data 
and pozdoc.cod=nomencl.cod 
and anexadoc.subunitate=avnefac.subunitate and anexadoc.tip=avnefac.tip and anexadoc.numar=avnefac.numar and anexadoc.data=avnefac.data 
and pozdoc.numar=doc.numar 
--and gestiuni.cod_gestiune=pozdoc.Gestiune_primitoare 
AND AVNEFAC.TERMINAL='8560' 
--GROUP BY pozdoc.numar_pozitie, pozdoc.cod, pozdoc.pret_cu_amanuntul, pozdoc.valuta,pozdoc.gestiune 
--ORDER BY pozdoc.numar_pozitie, pozdoc.cod
--select * from avnefac where AVNEFAC.TERMINAL='8560' 
--select * from pozdoc where po