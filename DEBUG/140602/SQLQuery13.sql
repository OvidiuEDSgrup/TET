SELECT left(convert(char(20),convert(money,MAX(doc.Valoare_valuta)),2),18)

,(select val_alfanumerica as nume from par where tip_parametru='GE' and parametru='NUME') as C001, max(DVI.NUMAR_DVI) as C002, max(gestiuni.denumire_gestiune) as C003, max(terti.denumire) as C004, max(pozdoc.factura) as C005, rtrim(max(pozdoc.numar)) as C006, max(convert(char(12),pozdoc.data_FACTURII,104)) as C007, max(convert(char(12),pozdoc.data,104)) as C008, MAX(POZDOC.VALUTA) as C009, left(convert(char(20),convert(money,max(DVI.valoare_cif_lei)),2),18) as C010, left(convert(char(20),convert(money,max(DVI.Valoare_CIF)),2),18) as C011, substring(convert(char(17),convert(money,round(pozdoc.pret_de_stoc*pozdoc.cantitate,2)),1),4,14) as C012, nomencl.um as C013, convert(char(17),convert(money,round(sum(pozdoc.detalii.value('(/row/@taxe_vama)[1]','float')),2)),1) as C014, left(convert(char(20),convert(money,max(DVI.TVA_22)),2),18) as C015, left(convert(char(20),convert(money,((select max(p.pret_de_stoc) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar) and (p.tip='RZ' or p.tip='RP')))),2),18) as C016, left(convert(char(20),convert(money,((select max(p.pret_valuta) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar) and (p.tip='RZ' or p.tip='RP')))),2),18) as C017, left(convert(char(20),convert(money,max(DVI.suma_vama+dif_vama)),2),18) as C018, left(convert(char(18),convert(money,pozdoc.pret_valuta*pozdoc.curs),2),17) as C019, left(convert(char(18),convert(money,pozdoc.pret_de_stoc),2),17) as C020, row_number() OVER(ORDER BY pozdoc.numar_pozitie) as C021, max(nomencl.denumire) as C022, left(convert(char(20),convert(money,MAX(DVI.CURS)),2),20) as C023, rtrim(pozdoc.cod) as C024, substring(convert(char(18),convert(money,round(pozdoc.cantitate,2)),2),6,8) as C025, left(convert(char(20),convert(money,((select(sum(round(p.pret_de_stoc*p.cantitate,2))-sum(p.TVA_deductibil)-(select max(p.pret_valuta) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar) and (p.tip='RZ' or p.tip='RP')))/max(dvi.curs)  from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.tip=max(pozdoc.tip) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar)))),2),18) as C026, left(convert(char(20),convert(money,((select sum(round(p.pret_de_stoc*p.cantitate,2))-sum(p.TVA_deductibil)-(select max(p.pret_valuta) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar) and (p.tip='RZ' or p.tip='RP')) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.tip=max(pozdoc.tip) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar)))),2),18) as C027, convert(char(17),convert(money,round((select sum(round(p.pret_de_stoc*p.cantitate,2)) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.tip=max(pozdoc.tip) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar)),2)),1) as C028, convert(char(17),convert(money,sum( round(sum(pozdoc.detalii.value('(/row/@taxe_vama)[1]','float')),2)) over(partition by pozdoc.subunitate,pozdoc.tip,pozdoc.numar,pozdoc.data)),1) as C029, convert(char(17),convert(money,round((select (sum(p.pret_de_stoc*p.cantitate)+sum(p.TVA_deductibil)) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.tip=max(pozdoc.tip) and p.numar=max(pozdoc.numar) and p.data=max(pozdoc.data)),2)),1) as C030, left(convert(char(20),convert(money,((select(sum(round(p.pret_de_stoc*p.cantitate,2))-sum(p.TVA_deductibil)-max(DVI.valoare_cif_lei)-(select max(p.pret_valuta) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar) and (p.tip='RZ' or p.tip='RP')))/max(dvi.curs)  from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.tip=max(pozdoc.tip) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar)))),2),18) as C031, left(convert(char(20),convert(money,((select sum(round(p.pret_de_stoc*p.cantitate,2))-sum(p.TVA_deductibil)-max(DVI.valoare_cif_lei)-(select max(p.pret_valuta) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar) and (p.tip='RZ' or p.tip='RP')) from pozdoc p where p.subunitate=max(pozdoc.subunitate) and p.tip=max(pozdoc.tip) and p.data=max(pozdoc.data) and p.numar=max(pozdoc.numar)))),2),18) as C032, max(anexadoc.observatii) as C033, max(anexadoc.mijloc_de_transport) as C034, max(anexadoc.eliberat) as C035, max(anexadoc.numele_delegatului) as C036,'' AS C037,'' AS C038,'' AS C039,'' AS C040,'' AS C041,'' AS C042,'' AS C043,'' AS C044,'' AS C045,'' AS C046,'' AS C047,'' AS C048,'' AS C049,'' AS C050,'' AS C051,'' AS C052,'' AS C053,'' AS C054,'' AS C055,'' AS C056,'' AS C057,'' AS C058,'' AS C059,'' AS C060,'' AS C061,'' AS C062,'' AS C063,'' AS C064,'' AS C065,'' AS C066,'' AS C067,'' AS C068,'' AS C069,'' AS C070,'' AS C071,'' AS C072,'' AS C073,'' AS C074,'' AS C075,'' AS C076,'' AS C077,'' AS C078,'' AS C079,'' AS C080,'' AS C081,'' AS C082,'' AS C083,'' AS C084,'' AS C085,'' AS C086,'' AS C087,'' AS C088,'' AS C089,'' AS C090,'' AS C091,'' AS C092,'' AS C093,'' AS C094,'' AS C095,'' AS C096,'' AS C097,'' AS C098,'' AS C099,'' AS C100 FROM avnefac,pozdoc,nomencl,terti,gestiuni,anexadoc,dvi,doc WHERE avnefac.subunitate=pozdoc.subunitate and avnefac.tip=pozdoc.tip and avnefac.numar=pozdoc.numar and avnefac.data=pozdoc.data and avnefac.cod_gestiune=pozdoc.gestiune and pozdoc.cod=nomencl.cod and terti.subunitate=avnefac.subunitate and terti.tert=pozdoc.tert and anexadoc.subunitate=pozdoc.subunitate and anexadoc.tip='RD' and anexadoc.numar=pozdoc.numar and anexadoc.data=pozdoc.data and gestiuni.subunitate=avnefac.subunitate and gestiuni.cod_gestiune=pozdoc.gestiune and pozdoc.Numar=dvi.Numar_receptie and doc.subunitate=pozdoc.subunitate and doc.tip=pozdoc.tip and doc.data=pozdoc.data and doc.numar=pozdoc.numar AND AVNEFAC.TERMINAL='7392' GROUP BY pozdoc.subunitate,pozdoc.tip,pozdoc.numar,pozdoc.data,pozdoc.cod, pozdoc.pret_vanzare, pozdoc.factura, nomencl.um, pozdoc.cantitate, pozdoc.pret_de_stoc, pozdoc.tva_deductibil, pozdoc.numar_pozitie,pozdoc.pret_valuta,pozdoc.curs ORDER BY pozdoc.numar_pozitie